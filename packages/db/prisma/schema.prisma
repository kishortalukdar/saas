generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://postgres:postgres@localhost:5432/postgres"
}

CREATE TABLE admin_users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL, -- hashed
  created_at TIMESTAMPTZ DEFAULT now()
);


-- Tenants table: represents each company
CREATE TABLE tenants (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  company_name TEXT NOT NULL, 
  gstin_no NUMERIC, 
  is_active BOOLEAN DEFAULT TRUE,
  plan_id UUID REFERENCES plans(id),
  created_at TIMESTAMPTZ DEFAULT now(),
);

-- Users table: linked to a tenant
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  tenant_id UUID NOT NULL REFERENCES tenants(id) ON DELETE CASCADE,
  email TEXT UNIQUE NOT NULL,
  role TEXT DEFAULT 'admin', 
  created_at TIMESTAMPTZ DEFAULT now()
);

-- Plans table (optional, if plans are dynamic)
CREATE TABLE plans (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT UNIQUE NOT NULL,
  price NUMERIC(10, 2) NOT NULL DEFAULT 0,
  billing_cycle TEXT CHECK (billing_cycle IN ('monthly', 'yearly')) NOT NULL DEFAULT 'monthly',
  is_free BOOLEAN DEFAULT FALSE
);



-- Feature flags per tenant (optional)
CREATE TABLE features (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  code TEXT NOT NULL UNIQUE,         -- e.g., 'export', 'reports'
  description TEXT
);

CREATE TABLE plan_features (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  plan_id UUID REFERENCES plans(id) ON DELETE CASCADE,
  feature_id UUID REFERENCES features(id) ON DELETE CASCADE,
  enabled BOOLEAN DEFAULT false,
  value TEXT, -- Optional: for limits like "10 users"
  UNIQUE (plan_id, feature_id)
);


-- Subscriptions (if youâ€™re managing payments/trials)
CREATE TABLE subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  tenant_id UUID NOT NULL REFERENCES tenants(id) ON DELETE CASCADE,
  plan_id INTEGER REFERENCES plans(id),
  is_active BOOLEAN DEFAULT true,
  trial_start TIMESTAMPTZ,
  trial_end TIMESTAMPTZ,
  subscribed_at TIMESTAMPTZ DEFAULT now()
);
